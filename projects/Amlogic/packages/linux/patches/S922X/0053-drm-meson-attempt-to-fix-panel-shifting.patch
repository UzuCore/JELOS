From 2fba3a08b8af659f8ff25e9c18daa530f4183146 Mon Sep 17 00:00:00 2001
From: adamg <adamg88@users.noreply.github.com>
Date: Fri, 26 Jan 2024 10:14:46 +0000
Subject: [PATCH] drm: meson: attempt to fix panel shifting

---
 drivers/gpu/drm/meson/meson_dw_mipi_dsi.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/drivers/gpu/drm/meson/meson_dw_mipi_dsi.c b/drivers/gpu/drm/meson/meson_dw_mipi_dsi.c
index 72abe2057ec31e..ce57f4a8ac678e 100644
--- a/drivers/gpu/drm/meson/meson_dw_mipi_dsi.c
+++ b/drivers/gpu/drm/meson/meson_dw_mipi_dsi.c
@@ -170,6 +170,13 @@ dw_mipi_dsi_get_lane_mbps(void *priv_data, const struct drm_display_mode *mode,
 					 bpp, mipi_dsi->dsi_device->lanes,
 					 &mipi_dsi->phy_opts.mipi_dphy);
 
+	/* Add some extra margin between the Pixel clock and Bit clock in BURST mode */
+	if (mode_flags & MIPI_DSI_MODE_VIDEO_BURST)
+		phy_mipi_dphy_get_default_config_for_hsclk(mipi_dsi->phy_opts.mipi_dphy.hs_clk_rate +
+							   mode->clock * 1000,
+							   mipi_dsi->dsi_device->lanes,
+							   &mipi_dsi->phy_opts.mipi_dphy);
+
 	*lane_mbps = DIV_ROUND_UP(mipi_dsi->phy_opts.mipi_dphy.hs_clk_rate, USEC_PER_SEC);
 
 	return 0;
